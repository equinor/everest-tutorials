definitions:          
  eclbase: eclipse/model/r{{case_name}}
  ecl_initial_data: r{{configpath}}/../../eclipse/model/DROGON
  eclipse_folder: r{{configpath}}/../../eclipse/model
  realization_folder: r{{configpath}}/../../../ensemble/realizations/realization-r{{realization}}
  user_shortname: r{{os.USER}}
  case_name: DROGON_WELL_PATH
  
environment:
  simulation_folder: r{{configpath}}/../output/r{{case_name}}/r{{user_shortname}}/r{{case_name}}
  output_folder: r{{configpath}}/../output/r{{case_name}}
  random_seed: 202220928

wells:
  - {name: A1}
  - {name: A2}
  - {name: A3}
  - {name: A4}
  - {name: A5}
  - {name: A6}

controls:
  - name: p1_x
    type: generic_control         
    perturbation_magnitude: 0.01
    min: -0.5
    max:  0.5
    variables:
      - {name: A1, initial_guess: -0.104553906} # x_initial = x_reference + initial_guess * x_scale
      - {name: A2, initial_guess: -0.253736645}
      - {name: A3, initial_guess: -0.038846954}
      - {name: A4, initial_guess: 0.110810323}
      - {name: A5, initial_guess: -0.193140003}
      - {name: A6, initial_guess: -0.219524074}
  - name: p1_y
    type: generic_control         
    perturbation_magnitude: 0.01
    min: -0.5
    max:  0.5
    variables:
      - {name: A1, initial_guess:  0.172874822} # y_initial = y_reference + initial_guess * y_scale
      - {name: A2, initial_guess:  0.124407425}
      - {name: A3, initial_guess:  -0.03346343}
      - {name: A4, initial_guess:  -0.227839124}
      - {name: A5, initial_guess:  0.438621291}
      - {name: A6, initial_guess:  -0.182205299}
  - name: p1_z
    type: generic_control         
    perturbation_magnitude: 0.01
    min: -0.5
    max:  0.5
    variables:
      - {name: A1, initial_guess: -0.264586466}  # z_initial = z_reference + initial_guess * z_scale
      - {name: A2, initial_guess: 0.019022556}
      - {name: A3, initial_guess: -0.180075188}
      - {name: A4, initial_guess: -0.029473684}
      - {name: A5, initial_guess: 0.422105263}
      - {name: A6, initial_guess: 0.425112782}
  - name: p2_a
    type: generic_control         
    perturbation_magnitude: 0.01
    min: 0.0
    max: 1.0
    variables:
      - {name: A1, initial_guess:  0.5}
      - {name: A2, initial_guess:  0.5}
      - {name: A3, initial_guess:  0.5}
      - {name: A4, initial_guess:  0.5}
      - {name: A5, initial_guess:  0.5}
      - {name: A6, initial_guess:  0.5}
  - name: p2_b
    type: generic_control         
    perturbation_magnitude: 0.01
    min: -0.3
    max:  0.3
    variables:
      - {name: A1, initial_guess:  0.0}
      - {name: A2, initial_guess:  0.0}
      - {name: A3, initial_guess:  0.0}
      - {name: A4, initial_guess:  0.0}
      - {name: A5, initial_guess:  0.0}
      - {name: A6, initial_guess:  0.0} 
  - name: p2_c
    type: generic_control         
    perturbation_magnitude: 0.01
    min: 0.0
    max: 1.0
    variables:
      - {name: A1, initial_guess:  0.5}
      - {name: A2, initial_guess:  0.5}
      - {name: A3, initial_guess:  0.5}
      - {name: A4, initial_guess:  0.5}
      - {name: A5, initial_guess:  0.5}
      - {name: A6, initial_guess:  0.5}
  - name: p3_x
    type: generic_control         
    perturbation_magnitude: 0.01
    min: -0.5
    max:  0.5
    variables:
      - {name: A1, initial_guess: -0.059725267}
      - {name: A2, initial_guess: -0.254209796}
      - {name: A3, initial_guess: -0.022711253}
      - {name: A4, initial_guess: 0.195411406}
      - {name: A5, initial_guess: -0.196660191}
      - {name: A6, initial_guess: -0.218622173}
  - name: p3_y
    type: generic_control         
    perturbation_magnitude: 0.01
    min: -0.5
    max:  0.5
    variables:
      - {name: A1, initial_guess:  0.16741869}
      - {name: A2, initial_guess:  0.114981755}
      - {name: A3, initial_guess:  -0.037456767}
      - {name: A4, initial_guess:  -0.044475647}
      - {name: A5, initial_guess:  0.40824052}
      - {name: A6, initial_guess:  -0.192519435}
  - name: p3_z
    type: generic_control         
    perturbation_magnitude: 0.01
    min: -0.5
    max:  0.8
    variables:
      - {name: A1, initial_guess:  0.032631579} 
      - {name: A2, initial_guess:  0.090601504} 
      - {name: A3, initial_guess:  0.140225564} 
      - {name: A4, initial_guess:  0.181203008} 
      - {name: A5, initial_guess:  0.649774436}
      - {name: A6, initial_guess:  0.72}

objective_functions:
  -
    name: npv
    weight: 1
    normalization: 0.000000001

optimization:
  algorithm: optpp_q_newton
  min_realizations_success: 1
  min_pert_success: 1
  max_function_evaluations: 1000
  perturbation_num: 1
  max_iterations: 10
  max_batch_num: 10
  speculative: True
  options:
    - "max_step = 0.1"
 
model:
  realizations: [0,1,2,3,4,5,6,7,8,9] 
  data_file: r{{ecl_initial_data}}.DATA

simulator:
  queue_system:
    name: lsf
    lsf_queue: mr
    max_running: 100
  max_runtime: 10000
  resubmit_limit: 0
  
install_data:
  - link: False
    source: r{{ecl_initial_data}}.DATA
    target: r{{eclbase}}.DATA
  - link: False
    source: r{{eclipse_folder}}/drogon_wells.sch
    target: eclipse/model/WELLPATH.SCH     
  - link: False
    source: r{{configpath}}/../input/files/prices.yml
    target: prices.yml
  - link: True
    source: r{{realization_folder}}/include
    target: eclipse/include 
  - link: True
    source: r{{configpath}}/../input/files
    target: files

forward_model:
  # update schedule
  - well_trajectory -c files/well_trajectory_input.yml -E r{{realization_folder}}/model/DROGON_SIM
  
  # run simulation  
  - eclipse100 --version 2021.1 r{{eclbase}}.DATA
 
  # calculate objective function
  - npv -s r{{eclbase}}.UNSMRY -o npv -c prices.yml -sd 2022-10-01 -ed 2027-01-01 -i files/aw_readydates.json
  